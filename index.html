<script>
  document.addEventListener('DOMContentLoaded', () => {
    const rows = document.querySelectorAll("tbody tr");

    const rankingPorPais = {};
    const rankingPorPessoa = {};

    rows.forEach(row => {
      // Conta paÃ­ses pelas bandeiras (alt)
      const flags = Array.from(row.querySelectorAll(".flags img")).map(img => img.alt.trim());
      flags.forEach(flag => {
        rankingPorPais[flag] = (rankingPorPais[flag] || 0) + 1;
      });

      // Conta pessoas pelos nomes entre parÃªnteses no campo Tema
      const tema = row.children[1].textContent;
      const match = tema.match(/î€([^)]+)î€/); // â† regex corrigido
      if (match && match[1]) {
        const pessoa = match[1].trim();
        rankingPorPessoa[pessoa] = (rankingPorPessoa[pessoa] || 0) + 1;
      }
    });

    const sortedPaises = Object.entries(rankingPorPais).sort((a, b) => b[1] - a[1]);
    const sortedPessoas = Object.entries(rankingPorPessoa).sort((a, b) => b[1] - a[1]);

    const container = document.createElement('section');
    container.className = 'section';
    container.style.display = 'flex';
    container.style.flexWrap = 'wrap';
    container.style.gap = '2rem';

    const paisDiv = document.createElement('div');
    paisDiv.style.flex = '1';
    paisDiv.innerHTML = `
      <h2>ğŸ Ranking por PaÃ­s</h2>
      <table>
        <thead><tr><th>PaÃ­s</th><th>Pulses</th></tr></thead>
        <tbody>
          ${sortedPaises.map(([pais, count]) => `
            <tr><td>${pais}</td><td>${count}</td></tr>
          `).join('')}
        </tbody>
      </table>
    `;

    const pessoaDiv = document.createElement('div');
    pessoaDiv.style.flex = '1';
    pessoaDiv.innerHTML = `
      <h2>ğŸ§‘â€ğŸ’» Ranking por Pesquisador</h2>
      <table>
        <thead><tr><th>Pesquisador</th><th>Pulses</th></tr></thead>
        <tbody>
          ${sortedPessoas.map(([nome, count]) => `
            <tr><td>${nome}</td><td>${count}</td></tr>
          `).join('')}
        </tbody>
      </table>
    `;

    container.appendChild(paisDiv);
    container.appendChild(pessoaDiv);

    // INSERE ANTES DA SEÃ‡ÃƒO "ğŸ“Œ Pulses Publicados"
    const pulseSection = Array.from(document.querySelectorAll('.section')).find(s => 
      s.querySelector('h2')?.textContent?.includes('Pulses Publicados')
    );

    if (pulseSection) {
      pulseSection.parentNode.insertBefore(container, pulseSection);
    }
  });
</script>
